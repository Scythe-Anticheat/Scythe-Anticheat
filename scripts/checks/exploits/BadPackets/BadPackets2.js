import Check from "../../../assets/Check.js";
import { world } from "@minecraft/server";

class BadPackets2 extends Check {
    /**
     * @class
     * @description Check if a message is either blank to exceeds Minecraft's maximum chat length
     */
    constructor() {
        super();

        this.check = "BadPackets";
        this.subcheck = "2";
        this.type = "Exploit";

        console.log(this.config.enabled);
        if(this.config.enabled) this.enable();
    }

    enable() {
        console.log("Loaded BadPackets2 check!");
        world.beforeEvents.chatSend.subscribe((...args) => this.beforeChatSend(...args));
    }

    disable() {
        world.beforeEvents.chatSend.unsubscribe(this.beforeChatSend);
    }

    beforeChatSend(msg) {
        console.log(1);
        const { sender, message } = msg;

        if(
            message.length === 0 ||
            message.length > this.config.maxLength
        ) {
            this.delayedFlag(sender, `length=${message.length}`);
            msg.cancel = true;
        }
    }
}

export default new BadPackets2();