// @ts-check
import Check from "../../../assets/Check.js";
import { world, GameMode } from "@minecraft/server";

// While the InstaBreak method used in Horion and Zephyr are patched, there are still some bypasses that exist
class InstabreakA extends Check {
	/**
	 * @class
	 * @description Check for breaking unbreakable blocks while not in Creative
	 */
	constructor() {
		super();

		this.check = "Instabreak";
		this.subcheck = "A";
		this.type = "Exploit";

		if(this.config.enabled) this.enable();
	}

	enable() {
		world.beforeEvents.playerBreakBlock.subscribe((...args) => this.beforePlayerBreakBlock(...args));
	}

	disable() {
		world.beforeEvents.playerBreakBlock.unsubscribe(this.beforePlayerBreakBlock);
	}

	/**
	 * @param {import("@minecraft/server").PlayerBreakBlockBeforeEvent} data
	 */
	beforePlayerBreakBlock(data) {
		const { player, block } = data;

		if(
			player.gamemode !== GameMode.Creative &&
			this.config.unbreakable_blocks.includes(block.typeId)
		) {
			this.delayedFlag(player, `block=${block.typeId}`);
			data.cancel = true;
		}
	}
}

export default new InstabreakA();