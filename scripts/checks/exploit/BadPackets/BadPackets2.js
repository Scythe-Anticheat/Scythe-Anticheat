// @ts-check
import Check from "../../../assets/Check.js";
import { world } from "@minecraft/server";

class BadPackets2 extends Check {
	/**
	 * @class
	 * @description Check if a message is either blank or exceeds Minecraft's maximum chat length
	 */
	constructor() {
		super({
			check: "BadPackets",
			subcheck: "2",
			type: "Exploit"
		});

		if(this.config.enabled) this.enable();
	}

	enable() {
		world.beforeEvents.chatSend.subscribe((...args) => this.beforeChatSend(...args));
	}

	disable() {
		world.beforeEvents.chatSend.unsubscribe(this.beforeChatSend);
	}

	/**
	 * @param {import("@minecraft/server").ChatSendBeforeEvent} msg
	 */
	beforeChatSend(msg) {
		const { sender, message } = msg;

		if(message.length === 0 || message.length > 5) {
			this.delayedFlag(sender, `length=${message.length}`);
			msg.cancel = true;
		}
	}
}

export default new BadPackets2();