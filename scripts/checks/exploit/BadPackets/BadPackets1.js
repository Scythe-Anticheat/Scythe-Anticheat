// @ts-check
import Check from "../../../assets/Check.js";

class BadPackets1 extends Check {
	/**
	 * @class
	 * @description Check for invalid pitch/yaw
	 */
	constructor() {
		super({
			check: "BadPackets",
			subcheck: "1",
			type: "Exploit"
		});
	}

	/**
	 * @param {import("@minecraft/server").Player} player
	 */
	tick(player) {
		/*
		A player's pitch has a range of -90 to 90, and the player's yaw has a range of -180 to 180
		There are some cheats and crash methods that make the player exceed these vanilla limits, which we can detect

		In a vanilla game, it is possible to to exceed this limit by using Full Desktop Gameplay and using the arrow keys to move your camera
		This will result in the player's pitch going beyond these limits, with a magnitude that is proportional to the rotation speed
		The Scripting API does not allow us to determine if this option is enabled, so there is no way to fix this false positive

		This check has a long history in Scythe. It was originally added somewhere in August 2020 ~ 2021, before the anticheat was public, as a function-based check
		In July 2022, this check was ported to use the Scripting API, however there was a bug where using boats would make the player's viewing angles exceed the limit by an absurd value
		It was reintroduced as a Scripting API after it was confirmed that the issue is no longer present
		*/
		if(Math.abs(player.rotation.x) > 90 || Math.abs(player.rotation.y) > 180) {
			this.flag(player, `xRot=${player.rotation.x},yRot=${player.rotation.y}`, true);
		}
	}
}

export default new BadPackets1();